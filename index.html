<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é„­å‘æ™´å°å¯æ„›çš„å€‹äººç©ºé–“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">
    <style>
        :root { --primary-pink: #ffb7c5; --soft-purple: #e2d1f9; }
        body { font-family: 'Noto Sans TC', sans-serif; background: linear-gradient(135deg, #fff5f7 0%, #f0f4ff 100%); scroll-behavior: smooth; overflow-x: hidden; }
        .cute-title { font-family: 'Zhi Mang Xing', cursive, sans-serif; }
        .floating { animation: floating 3s ease-in-out infinite; }
        @keyframes floating { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }
        .heart-particle { position: absolute; pointer-events: none; animation: flyUp 2s linear forwards; z-index: 100; }
        @keyframes flyUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-100px) scale(1.5); opacity: 0; } }
        .glass-morphism { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .gallery-item { overflow: hidden; position: relative; border-radius: 1.5rem; box-shadow: 0 10px 25px rgba(255, 183, 197, 0.3); background: #fff; transition: all 0.3s ease; }
        .gallery-item img { transition: transform 0.5s ease; width: 100%; height: 100%; object-fit: cover; min-height: 200px; }
        .gallery-item:hover { transform: translateY(-5px); }
        .gallery-item:hover img { transform: scale(1.1); }
        .gallery-caption { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.7)); color: white; padding: 10px; font-size: 0.8rem; opacity: 0; transition: opacity 0.3s; text-align: center; }
        .gallery-item:hover .gallery-caption { opacity: 1; }
        .admin-panel { display: none; }
        .admin-active .admin-panel { display: block; }
    </style>
</head>
<body class="text-gray-800">

    <nav class="fixed w-full z-50 glass-morphism px-6 py-4 flex justify-between items-center">
        <div class="text-2xl font-bold text-pink-500">å‘æ™´ ğŸ¬</div>
        <div class="space-x-4 md:space-x-6 hidden sm:flex">
            <a href="#home" class="hover:text-pink-400 transition">é¦–é </a>
            <a href="#about" class="hover:text-pink-400 transition">é—œæ–¼æˆ‘</a>
            <a href="#gallery" class="hover:text-pink-400 transition">ç”œèœœç¬é–“</a>
            <a href="#guestbook" class="hover:text-pink-400 transition">æ‚„æ‚„è©±</a>
        </div>
    </nav>

    <!-- ä¸»è¦–è¦ºå€å¡Š -->
    <section id="home" class="min-h-screen flex flex-col items-center justify-center pt-20 overflow-hidden relative">
        <div class="absolute inset-0 pointer-events-none opacity-20">
            <div class="absolute top-20 left-10 text-4xl floating">â­</div>
            <div class="absolute bottom-20 right-10 text-4xl floating" style="animation-delay: 1s;">ğŸ­</div>
            <div class="absolute top-40 right-20 text-4xl floating" style="animation-delay: 0.5s;">â˜ï¸</div>
        </div>
        <div class="text-center z-10 px-4">
            <div class="mb-6 inline-block p-4 rounded-full bg-white shadow-xl floating">
                <div class="w-44 h-44 md:w-60 md:h-60 rounded-full overflow-hidden border-8 border-pink-100 bg-pink-50">
                    <img id="img_hero" src="20250206_153614.jpg" alt="å‘æ™´å¤§é ­ç…§" class="w-full h-full object-cover">
                </div>
            </div>
            <h1 class="text-5xl md:text-7xl font-bold text-pink-500 mb-4 cute-title">é„­å‘æ™´å°å¯æ„›</h1>
            <p class="text-lg md:text-xl text-gray-500 mb-8">æ”¶é›†ä¸–é–“æ‰€æœ‰çš„æº«æŸ”èˆ‡å¯æ„› âœ¨</p>
            <button onclick="createHearts(event)" class="bg-pink-400 hover:bg-pink-500 text-white px-10 py-4 rounded-full shadow-lg transition transform hover:scale-105 active:scale-95 text-lg font-bold">
                é€æˆ‘æ„›å¿ƒ ğŸ’–
            </button>
        </div>
    </section>

    <!-- é—œæ–¼æˆ‘ -->
    <section id="about" class="py-24 px-6 max-w-5xl mx-auto">
        <h2 class="text-4xl font-bold text-center text-pink-400 mb-12 cute-title">é—œæ–¼å°å¯æ„›</h2>
        <div class="grid md:grid-cols-2 gap-12 items-center">
            <div class="glass-morphism p-10 rounded-3xl shadow-sm leading-relaxed text-gray-700">
                <p class="text-xl mb-6">å—¨ï¼æˆ‘æ˜¯å‘æ™´ï¼Œå¤§å®¶å…¬èªçš„å°å¯æ„›ã€‚æˆ‘å–œæ­¡çœ‹æ›¸ã€å½ˆç´ï¼Œä¹Ÿå–œæ­¡å’Œå®¶äººåˆ°è™•å»å†’éšªåƒç¾é£Ÿï¼</p>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="bg-white/80 p-4 rounded-2xl shadow-sm border border-pink-50">
                        <span class="block text-3xl">ğŸ“</span>
                        <span class="text-sm font-bold text-pink-400">æ„›åƒè‰è“</span>
                    </div>
                    <div class="bg-white/80 p-4 rounded-2xl shadow-sm border border-pink-50">
                        <span class="block text-3xl">ğŸ¶</span>
                        <span class="text-sm font-bold text-pink-400">æ„›å½ˆç´ç´</span>
                    </div>
                </div>
            </div>
            <div class="relative">
                <div class="rounded-3xl overflow-hidden shadow-2xl rotate-2 border-[12px] border-white bg-pink-50">
                    <img id="img_about" src="20250104_193151.jpg" alt="åƒè‰è“çš„ç…§ç‰‡" class="w-full h-80 object-cover">
                </div>
            </div>
        </div>
    </section>

    <!-- ç›¸ç°¿å€å¡Š -->
    <section id="gallery" class="py-24 bg-white/40 px-6">
        <h2 class="text-4xl font-bold text-center text-pink-400 mb-12 cute-title">ç”œèœœç¬é–“</h2>
        <p class="text-center text-gray-500 mb-12">è¨˜éŒ„æˆ‘çš„æ¯ä¸€å€‹æˆé•·å°æ•…äº‹</p>
        <div id="gallery_grid" class="max-w-6xl mx-auto grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            <!-- åœ–ç‰‡å°‡ç”± JavaScript å‹•æ…‹è¼‰å…¥ -->
        </div>
    </section>

    <!-- ç•™è¨€æ¿ -->
    <section id="guestbook" class="py-24 px-6 max-w-2xl mx-auto">
        <div class="glass-morphism p-10 rounded-[2.5rem] shadow-xl text-center">
            <h2 class="text-3xl font-bold text-pink-400 mb-8 cute-title">æ‚„æ‚„è©±ç‰†</h2>
            <div id="messageBox" class="mb-8 space-y-4 max-h-80 overflow-y-auto pr-2 text-sm text-left">
                <div class="text-center py-4 text-gray-400" id="loadingMsg">æ­£åœ¨é€£ç·šè‡³é›²ç«¯...</div>
            </div>
            <div class="flex flex-col space-y-4">
                <input id="userName" type="text" placeholder="ä½ çš„ç¨±å‘¼" class="px-5 py-3 rounded-full border border-pink-100 outline-none focus:ring-2 focus:ring-pink-200">
                <textarea id="userMsg" rows="3" placeholder="æƒ³å°å‘æ™´èªªä»€éº¼ï¼Ÿ" class="px-5 py-3 rounded-3xl border border-pink-100 outline-none focus:ring-2 focus:ring-pink-200"></textarea>
                <button id="sendBtn" class="w-full bg-pink-400 text-white font-bold py-4 rounded-full hover:bg-pink-500 shadow-lg disabled:bg-gray-300">é€å‡ºç•™è¨€</button>
            </div>
        </div>
    </section>

    <!-- é›²ç«¯ç…§ç‰‡ç®¡ç†å¾Œå° -->
    <div id="adminContainer" class="admin-panel py-10 bg-gray-900 text-white px-6">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-pink-400">ğŸ“¸ é›²ç«¯ç…§ç‰‡ç®¡ç†å¾Œå°</h3>
                <button onclick="resetToLocal()" class="text-xs bg-red-900/50 px-3 py-1 rounded border border-red-500 text-red-200 hover:bg-red-800">é‡è¨­ç‚ºåˆå§‹ç…§ç‰‡</button>
            </div>
            
            <div class="space-y-4 text-sm">
                <div>
                    <label class="block mb-1 text-gray-400">å¤§é ­è²¼ï¼š</label>
                    <input id="input_hero" type="text" class="w-full p-2 bg-gray-800 border border-gray-700 rounded text-pink-300">
                </div>
                <div>
                    <label class="block mb-1 text-gray-400">é—œæ–¼æˆ‘ç…§ç‰‡ï¼š</label>
                    <input id="input_about" type="text" class="w-full p-2 bg-gray-800 border border-gray-700 rounded text-pink-300">
                </div>
                <div>
                    <label class="block mb-1 text-gray-400">ç›¸ç°¿ç…§ç‰‡ (æ¯è¡Œä¸€å€‹æª”åæˆ–ç¶²å€)ï¼š</label>
                    <textarea id="input_gallery" rows="10" class="w-full p-2 bg-gray-800 border border-gray-700 rounded text-pink-300"></textarea>
                </div>
                <button onclick="savePhotoConfig()" class="bg-pink-500 px-8 py-3 rounded-full font-bold hover:bg-pink-600 transition shadow-lg">å„²å­˜è®Šæ›´è‡³é›²ç«¯</button>
            </div>
        </div>
    </div>

    <footer class="py-12 text-center text-gray-400 text-sm">
        <p>Â© 2025 é„­å‘æ™´å°å¯æ„›å°ˆå±¬ç©ºé–“ â¤ï¸ | <button onclick="toggleAdmin()" class="hover:text-pink-300">ç®¡ç†æ¨¡å¼</button></p>
    </footer>

    <!-- Firebase é‚è¼¯ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, addDoc, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase é…ç½®ç”±ç’°å¢ƒè‡ªå‹•å¸¶å…¥
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-id';
        const configRef = doc(db, 'artifacts', appId, 'public', 'data', 'photoConfig', 'default');
        
        let user = null;

        // å¦³æä¾›çš„æ‰€æœ‰ç…§ç‰‡æª”å (ç²¾ç¢ºå°æ‡‰)
        const defaultPhotos = {
            hero: '20250206_153614.jpg',
            about: '20250104_193151.jpg',
            gallery: [
                '20250205_194430.jpg',
                '20250129_082834.jpg',
                '20250112_162245.jpg',
                '20250104_172109.jpg',
                '20250104_172053.jpg',
                '20250104_171603.jpg',
                '20250104_171444.jpg',
                '20250104_171450.jpg',
                '20250714_111924(0).jpg',
                '20250720_143703.jpg',
                '20250803_172158.jpg',
                '20250815_174653.jpg',
                '20250902_181256.jpg',
                '20250907_132712.jpg',
                '20251018_120229.jpg',
                '20251018_151029.jpg',
                '20251023_155406.jpg',
                '20251108_081246.jpg'
            ]
        };

        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };

        initAuth().then(() => {
            onAuthStateChanged(auth, (u) => {
                user = u;
                if (user) {
                    syncPhotos();
                    syncMessages();
                }
            });
        });

        // åµéŒ¯è¼”åŠ©ï¼šæª¢æŸ¥åœ–ç‰‡æ˜¯å¦ç‚º local æª”æ¡ˆä¸¦æ ¼å¼åŒ–è·¯å¾‘
        const formatPath = (p) => {
            if (!p) return "";
            if (p.startsWith('http') || p.startsWith('data:')) return p;
            // åŠ ä¸Š ./ ç¢ºä¿åœ¨ GitHub Pages ç›®éŒ„æ­£ç¢º
            return `./${p}`;
        };

        function syncPhotos() {
            onSnapshot(configRef, (snap) => {
                let data = snap.exists() ? snap.data() : defaultPhotos;
                
                // é˜²å‘†ï¼šå¦‚æœé›²ç«¯è³‡æ–™æ˜¯ç©ºçš„ï¼Œå‰‡ä½¿ç”¨é è¨­å€¼
                if (!data.hero) data = defaultPhotos;

                document.getElementById('img_hero').src = formatPath(data.hero);
                document.getElementById('img_about').src = formatPath(data.about);
                
                document.getElementById('input_hero').value = data.hero;
                document.getElementById('input_about').value = data.about;
                document.getElementById('input_gallery').value = (data.gallery || []).join('\n');

                const grid = document.getElementById('gallery_grid');
                grid.innerHTML = (data.gallery || []).map(url => `
                    <div class="gallery-item aspect-square shadow-sm">
                        <img src="${formatPath(url)}" 
                             class="w-full h-full object-cover" 
                             onerror="this.parentElement.style.display='none'; console.log('æ‰¾ä¸åˆ°åœ–ç‰‡:', '${url}')">
                        <div class="gallery-caption">âœ¨</div>
                    </div>
                `).join('');
            });
        }

        window.savePhotoConfig = async () => {
            if (!user) return;
            const hero = document.getElementById('input_hero').value.trim();
            const about = document.getElementById('input_about').value.trim();
            const gallery = document.getElementById('input_gallery').value.split('\n').map(l => l.trim()).filter(l => l !== '');
            try {
                await setDoc(configRef, { hero, about, gallery });
                alert('é›²ç«¯ç…§ç‰‡è¨­å®šå·²æ›´æ–°ï¼è«‹é‡æ–°æ•´ç†ç¶²é ã€‚');
            } catch (e) { alert('å„²å­˜å¤±æ•—ï¼š' + e.message); }
        };

        window.resetToLocal = async () => {
            if (confirm("ç¢ºå®šè¦é‡è¨­æ‰€æœ‰ç…§ç‰‡è·¯å¾‘ç‚ºåˆå§‹ç‹€æ…‹å—ï¼Ÿ")) {
                try {
                    await deleteDoc(configRef);
                    location.reload();
                } catch (e) { alert("é‡è¨­å¤±æ•—"); }
            }
        };

        function syncMessages() {
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'messages'), (snap) => {
                const loading = document.getElementById('loadingMsg'); if (loading) loading.remove();
                const msgs = [];
                snap.forEach(doc => msgs.push(doc.data()));
                msgs.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                document.getElementById('messageBox').innerHTML = msgs.map(m => `
                    <div class="bg-white/90 p-4 rounded-2xl shadow-sm border-l-4 border-pink-300">
                        <span class="font-bold text-pink-500">${m.name || 'è¨ªå®¢'}:</span> ${m.content}
                    </div>
                `).join('') || '<div class="text-center text-gray-400 py-4">å°šç„¡ç•™è¨€</div>';
            });
        }

        document.getElementById('sendBtn').onclick = async () => {
            const n = document.getElementById('userName').value, c = document.getElementById('userMsg').value;
            if (!user || !n || !c) return;
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'messages'), {
                name: n, content: c, createdAt: serverTimestamp()
            });
            document.getElementById('userName').value = '';
            document.getElementById('userMsg').value = '';
            createHearts();
        };
    </script>

    <script>
        function toggleAdmin() { document.body.classList.toggle('admin-active'); window.scrollTo(0, document.body.scrollHeight); }
        function createHearts(e) {
            const x = e ? e.clientX : window.innerWidth/2, y = e ? e.clientY : window.innerHeight/2;
            for(let i=0; i<15; i++) {
                const h = document.createElement('div');
                h.innerHTML = ['ğŸ’–','ğŸ’—','âœ¨','ğŸŒ¸','ğŸ­'][Math.floor(Math.random()*5)];
                h.className = 'heart-particle text-3xl';
                h.style.left = x + (Math.random()-0.5)*180 + 'px';
                h.style.top = y + (Math.random()-0.5)*180 + 'px';
                document.body.appendChild(h);
                setTimeout(() => h.remove(), 2000);
            }
        }
    </script>
</body>
</html>